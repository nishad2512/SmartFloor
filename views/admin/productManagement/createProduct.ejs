<%- include("../../partials/admin-header.ejs") %>
<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

<body class="bg-background-light dark:bg-background-dark font-display text-[#141414] dark:text-white">
    <%- include("../../partials/flash.ejs") %>
    <div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden">
        <div class="flex min-h-screen">
            <%- include("../../partials/sidebar.ejs") %>
            <main class="flex-1 p-6 lg:p-10">
                <div class="w-full mx-auto">
                    <div class="flex flex-wrap justify-between gap-4 items-center mb-6">
                        <div class="flex flex-col gap-1">
                            <p class="text-[#141414] dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]">
                                Add New Product
                            </p>
                            <p class="text-[#757575] dark:text-gray-400 text-base font-normal leading-normal">
                                Fill in the details to create a new product.
                            </p>
                        </div>
                    </div>
                    <form action="/admin/products/create" method="post" enctype="multipart/form-data"
                        onsubmit="return validateForm()">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="col-span-1 flex flex-col">
                                <div
                                    class="rounded-xl border border-[#e0e0e0] dark:border-primary/20 bg-white dark:bg-[#1f1f1f]">
                                    <div class="p-6 border-b border-[#e0e0e0] dark:border-primary/20">
                                        <h2 class="text-lg font-bold tracking-[-0.015em]">
                                            Product Information
                                        </h2>
                                    </div>
                                    <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-[#141414] dark:text-white mb-2"
                                                for="product-name">Product Name <span class="text-red-500">*</span></label>
                                            <input
                                                class="w-full bg-transparent border-[#e0e0e0] dark:border-primary/20 rounded-lg focus:ring-primary focus:border-primary text-sm"
                                                id="product-name" placeholder="e.g., Oak Hardwood Flooring" type="text"
                                                name="name" />
                                            <p id="name-error" class="text-red-500 text-xs mt-1 hidden">Product Name is required.</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-[#141414] dark:text-white mb-2"
                                                for="category">Category <span class="text-red-500">*</span></label>
                                            <select
                                                class="w-full bg-transparent border-[#e0e0e0] dark:border-primary/20 rounded-lg focus:ring-primary focus:border-primary text-sm"
                                                id="category" name="category">
                                                <option value="" disabled selected>Select a category</option>
                                                <% categories.forEach(category=> { %>
                                                <option value="<%= category.name %>">
                                                    <%= category.name %>
                                                </option>
                                                <% }) %>
                                            </select>
                                            <p id="category-error" class="text-red-500 text-xs mt-1 hidden">Category is required.</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-[#141414] dark:text-white mb-2"
                                                for="specifications">Specifications</label>
                                            <input
                                                class="w-full bg-transparent border-[#e0e0e0] dark:border-primary/20 rounded-lg focus:ring-primary focus:border-primary text-sm"
                                                id="specifications"
                                                placeholder="e.g., Material, Finish, Thickness, Usage" type="text"
                                                name="specifications" />
                                        </div>
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-[#141414] dark:text-white mb-2"
                                                for="highlights">Highlights</label>
                                            <input
                                                class="w-full bg-transparent border-[#e0e0e0] dark:border-primary/20 rounded-lg focus:ring-primary focus:border-primary text-sm"
                                                id="highlights" placeholder="e.g., Rich Oak Finish" type="text"
                                                name="highlights" />
                                        </div>
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium text-[#141414] dark:text-white mb-2"
                                                for="description">Product Description <span class="text-red-500">*</span></label>
                                            <textarea
                                                class="w-full bg-transparent border-[#e0e0e0] dark:border-primary/20 rounded-lg focus:ring-primary focus:border-primary text-sm"
                                                id="description" placeholder="Describe the product details..." rows="4"
                                                name="description"></textarea>
                                            <p id="description-error" class="text-red-500 text-xs mt-1 hidden">Product Description is required.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-span-1 flex flex-col gap-8">
                                <div
                                    class="rounded-xl border border-[#e0e0e0] dark:border-primary/20 bg-white dark:bg-[#1f1f1f]">
                                    <div class="p-6 border-b border-[#e0e0e0] dark:border-primary/20">
                                        <h2 class="text-lg font-bold tracking-[-0.015em]">
                                            Product Images
                                        </h2>
                                    </div>
                                    <div class="p-6">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Product
                                            Images (Min 3) <span class="text-red-500">*</span></label>
                                        <input type="file" name="images" multiple accept="image/*"
                                            class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                                            onchange="previewImages(event)" id="image-input">
                                        <small class="text-gray-500">You can select multiple files at once.</small>
                                        <p id="images-error" class="text-red-500 text-xs mt-1 hidden">You must upload at least 3 images.</p>

                                        <div id="image-preview" class="flex gap-2 mt-4 overflow-x-auto p-2">
                                        </div>
                                    </div>
                                </div>

                                <div
                                    class="rounded-xl border border-[#e0e0e0] dark:border-primary/20 bg-white dark:bg-[#1f1f1f]">
                                    <div
                                        class="p-6 border-b border-[#e0e0e0] dark:border-primary/20 flex justify-between items-center">
                                        <div>
                                            <h2 class="text-lg font-bold tracking-[-0.015em]">
                                                Product Variants
                                            </h2>
                                            <p class="text-sm text-[#757575] dark:text-gray-400 mt-1">
                                                Specify different sizes for this product.
                                            </p>
                                        </div>
                                        <button type="button" onclick="addVariant()"
                                            class="flex items-center gap-2 bg-primary/5 dark:bg-primary/20 text-primary dark:text-white font-medium px-4 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-primary/30 text-sm">
                                            <span class="material-symbols-outlined text-lg">add</span>
                                            Add Size
                                        </button>
                                    </div>
                                    <div class="p-6 space-y-4">
                                        <div
                                            class="grid grid-cols-[1fr_1fr_1fr_auto] gap-4 items-center pb-2 border-b border-transparent">
                                            <label
                                                class="text-xs font-medium text-[#757575] dark:text-gray-400">Size
                                                (e.g., 6" x 48") <span class="text-red-500">*</span></label>
                                            <label
                                                class="text-xs font-medium text-[#757575] dark:text-gray-400 text-center">Stock <span class="text-red-500">*</span></label>
                                            <label
                                                class="text-xs font-medium text-[#757575] dark:text-gray-400 text-center">Price <span class="text-red-500">*</span></label>
                                            <div class="w-8"></div>
                                        </div>
                                        <div id="variant-list">
                                            <div class="variant-row grid grid-cols-[1fr_1fr_1fr_auto] gap-4 items-center">
                                                <input
                                                    class="w-full bg-transparent border-[#e0e0e0] dark:border-primary/20 rounded-lg focus:ring-primary focus:border-primary text-sm"
                                                    placeholder='eg: 6" x 48"' type="text" name="size[]" />
                                                <input
                                                    class="w-full bg-transparent border-[#e0e0e0] dark:border-primary/20 rounded-lg focus:ring-primary focus:border-primary text-sm text-center"
                                                    placeholder="eg: 50" type="number" name="stock[]" />
                                                <input
                                                    class="w-full bg-transparent border-[#e0e0e0] dark:border-primary/20 rounded-lg focus:ring-primary focus:border-primary text-sm text-center"
                                                    placeholder="eg: $5.99" type="text" name="price[]" />
                                                <button type="button"
                                                    onclick="this.parentElement.remove(); validateVariants();"
                                                    class="remove-variant p-2 text-[#757575] dark:text-gray-400 hover:text-red-500 hover:bg-gray-100 dark:hover:bg-primary/30 rounded-full">
                                                    <span class="material-symbols-outlined text-xl">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                        <p id="variants-error" class="text-red-500 text-xs mt-1 hidden">At least one complete product variant (Size, Stock, Price) is required.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 flex justify-end gap-4">
                            <a href="/admin/products"
                                class="font-medium px-6 py-2.5 rounded-lg border border-[#e0e0e0] dark:border-primary/20 hover:bg-gray-100 dark:hover:bg-primary/20">
                                Cancel
                            </a>
                            <button type="submit"
                                class="bg-primary text-white font-medium px-6 py-2.5 rounded-lg hover:opacity-90">
                                Save Product
                            </button>
                        </div>
                    </form>
                </div>
            </main>
        </div>
    </div>
    <div id="cropper-modal"
        class="fixed inset-0 z-[60] hidden bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 transition-all duration-300">
        <div
            class="bg-white dark:bg-[#1f1f1f] rounded-2xl p-6 w-full max-w-2xl shadow-2xl transform transition-all scale-100">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-[#141414] dark:text-white">Crop Image</h3>
                <button onclick="skipCrop()"
                    class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <div class="relative w-full h-[400px] bg-[#f0f0f0] dark:bg-[#2a2a2a] rounded-xl overflow-hidden mb-6 group">
                <img id="cropper-image" src="" alt="To Crop"
                    class="max-w-full h-full object-contain mx-auto block">
            </div>

            <div class="flex justify-end gap-3 pt-2">
                <button type="button" onclick="skipCrop()"
                    class="px-5 py-2.5 rounded-xl border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                    Skip Cropping
                </button>
                <button type="button" onclick="saveCrop()"
                    class="px-5 py-2.5 rounded-xl bg-primary text-white font-medium hover:opacity-90 transition-opacity flex items-center gap-2">
                    <span class="material-symbols-outlined text-[20px]">crop</span>
                    Crop & Save
                </button>
            </div>
        </div>
    </div>

    <script src="/js/createProduct.js"></script>
</body>

</html>